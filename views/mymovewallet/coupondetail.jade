extends mymovemobile_layout

block content
	.nav.navbar-inverse.navbar-fixed-top(role="navigation")
		.container-fluid
			.navbar-header
				a.navbar-brand.pull-left(href="./brands") Back

	.container
		.row
			.col-xs-12
				.thumbnail
					img.img-responsive(src="http://cdn2.hubspot.net/hub/231191/file-23747466-png/wayfair.png?t=1363201553000")
					.caption
						h4 Up To 70% Off Father's Day Finds 
					.couponCodes No code needed
			

	script(type='text/javascript').
		var currentCoupon = JSON.parse(sessionStorage.getItem("current_coupon"));
		//alert(currentCoupon);
		$(".thumbnail").each(function(){
				$(this).find("img").attr("src",currentCoupon.brandPic);
				$(this).find("h4").text(currentCoupon.couponDes);
				$(this).find(".couponCodes").text(currentCoupon.couponCode);
				if(sessionStorage.getItem("is_saved")=="unSaved")
					$(this).append("<div class='saveButton' id='"+currentCoupon.objectId+"''>Save</div>");

			});
		

		$(".saveButton").click(function(e){
			
	
			var thisButton = this;
			
				//$(".test").text(userObjID);
				var User = Parse.Object.extend("User");
				var query = new Parse.Query(User);
				query.get(sessionStorage.getItem("userID"), {
					success: function(theCurrentUser) {
					// The object was retrieved successfully.
						var savedCoupons = theCurrentUser.get("savedCoupons");

						if(savedCoupons)
							savedCoupons.push($(thisButton).attr("id"));
						else
							savedCoupons = [$(thisButton).attr("id")];	

						theCurrentUser.set("savedCoupons",savedCoupons);

						theCurrentUser.save(null,{
							success:function(user){
								$(thisButton).css('background-color','#ddd').text('saved');
								$(thisButton).off('click');
								},
							error: function(user,error){
								alert(JSON.strinhgify(error));
							}
							});
					},
					error: function(object, error) {
					// The object was not retrieved successfully.
					// error is a Parse.Error with an error code and description.
					alert("download the MyMove app to save coupons");
					}
				});


			});












